@model IEnumerable<Project_65133141.Models.TinTuc>
@{
    ViewBag.Title = "Quản lý Tin tức & Ưu đãi";
    Layout = "~/Areas/Admin_65133141/Views/Shared/_Layout.cshtml";
}

<style>
    /* Card Grid Styles */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 1.5rem;
    }
    @@media (min-width: 640px) { .news-grid { grid-template-columns: repeat(2, 1fr); } }
    @@media (min-width: 1024px) { .news-grid { grid-template-columns: repeat(3, 1fr); } }

    .news-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #fee2e2;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(220, 38, 38, 0.1);
        border-color: #fca5a5;
    }

    .card-image-wrapper {
        position: relative;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        overflow: hidden;
        background-color: #f3f4f6;
    }

    .card-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .news-card:hover .card-image {
        transform: scale(1.05); /* Slight zoom on hover */
    }

    .card-badges {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        z-index: 10;
    }

    .badge-pill {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        color: white;
        background: rgba(0,0,0,0.5);
        backdrop-filter: blur(4px);
    }
    
    .badge-active { background-color: rgba(16, 185, 129, 0.9); }
    .badge-hidden { background-color: rgba(239, 68, 68, 0.9); }
    .badge-featured { background-color: rgba(245, 158, 11, 0.9); }
    
    .card-content {
        padding: 1.25rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .news-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .news-desc {
        font-size: 0.875rem;
        color: #6b7280;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .news-meta {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px solid #f3f4f6;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: #9ca3af;
    }
    
    .action-bar {
        background-color: #fef2f2;
        padding: 0.75rem 1.25rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .btn-edit {
        color: #d97706;
        font-weight: 600;
        font-size: 0.875rem;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        background: #fffbeb;
        border: 1px solid #fde68a;
        transition: all 0.2s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    .btn-edit:hover {
        background: #fef3c7;
        color: #b45309;
        text-decoration: none;
    }

    .btn-delete {
        color: #dc2626;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        transition: all 0.2s;
        background: white;
        border: 1px solid #fecaca;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .btn-delete:hover {
        background: #fee2e2;
        color: #b91c1c;
    }
    
    /* Pagination Styles */
    .pagination-container {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
        gap: 0.5rem;
    }
    
    .page-link {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: white;
        border: 1px solid #e5e7eb;
        color: #374151;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
    }
    
    .page-link:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
        text-decoration: none;
    }
    
    .page-link.active {
        background: #dc2626;
        border-color: #dc2626;
        color: white;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 1rem;
    }
</style>

<div class="container mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 md:py-8">
    <!-- Alert Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div id="successAlert" class="bg-green-100 border border-green-200 text-green-800 px-4 py-3 rounded-xl mb-6 flex items-center justify-between shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <div>
                    <div class="font-semibold text-sm">Thành công!</div>
                    <div class="text-sm">@TempData["SuccessMessage"]</div>
                </div>
            </div>
            <button onclick="document.getElementById('successAlert').remove()" class="text-green-600 hover:text-green-800">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <script>setTimeout(function() { var el = document.getElementById('successAlert'); if(el) el.remove(); }, 5000);</script>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div id="errorAlert" class="bg-red-100 border border-red-200 text-red-800 px-4 py-3 rounded-xl mb-6 flex items-center justify-between shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </div>
                <div>
                    <div class="font-semibold text-sm">Lỗi!</div>
                    <div class="text-sm">@TempData["ErrorMessage"]</div>
                </div>
            </div>
            <button onclick="document.getElementById('errorAlert').remove()" class="text-red-600 hover:text-red-800">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    }

    <!-- Header Section -->
    <div class="flex flex-col gap-4 sm:gap-6 mb-6 sm:mb-8 md:mb-10">
        <!-- Title and Actions Row -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <!-- Title Section -->
            <div>
                <h1 class="text-2xl sm:text-3xl font-black text-gray-900 tracking-tight">Quản lý Tin tức & Ưu đãi</h1>
                <p class="text-gray-500 text-sm sm:text-base font-medium mt-1">Tổng cộng: @ViewBag.TotalItems bài viết</p>
            </div>
            
            <!-- Actions Group: Add Button & Search -->
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full md:w-auto">
                <!-- Add Button -->
                <a href="@Url.Action("Create", "TinTuc", new { area = "Admin_65133141" })"
                   class="px-4 py-2.5 bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white rounded-xl font-bold text-sm transition-all shadow-md hover:shadow-lg active:shadow-md transform hover:scale-105 active:scale-95 flex items-center justify-center gap-2 cursor-pointer border-none text-decoration-none w-full sm:w-auto">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    <span>Thêm tin mới</span>
                </a>
                
                <!-- Search Box (Wrapped in Form for Server-side Search + Client-side Auto) -->
                <div class="relative flex-1 sm:flex-initial w-full sm:w-64 mb-0">
                     <form method="get" id="newsSearchForm" class="m-0">
                         <input type="text" 
                               id="newsSearchInput"
                               name="search" 
                               value="@ViewBag.Search"
                               placeholder="Tìm kiếm tin tức..." 
                               autocomplete="off"
                               class="w-full pl-10 pr-4 py-2.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all duration-200 text-gray-700 placeholder-gray-400">
                        <button type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 bg-transparent border-none p-0 cursor-pointer">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </button>
                     </form>
                    
                    <!-- Autocomplete Suggestions Dropdown -->
                    <div id="searchSuggestions" 
                         class="absolute top-full left-0 w-full mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden z-50 hidden">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Grid -->
    @if (Model != null && Model.Any())
    {
        <div class="news-grid" id="newsGrid">
            @foreach (var item in Model)
            {
                var imagePath = !string.IsNullOrWhiteSpace(item.HinhAnh)
                    ? Url.Content("~/Images/TinTuc/" + item.HinhAnh)
                    : Url.Content("~/Images/slide09.jpg"); // Fallback image

                <div class="news-card group" id="news-card-@item.TinTucID">
                    <!-- Clickable Area - Links to Details -->
                    <a href="@Url.Action("Details", "TinTuc", new { area = "Admin_65133141", id = item.TinTucID })" class="block cursor-pointer text-decoration-none">
                        <!-- Image Area -->
                        <div class="card-image-wrapper">
                            <img src="@imagePath" alt="@item.TieuDe" class="card-image" onerror="this.src='@Url.Content("~/Images/slide09.jpg")'" />
                            
                            <!-- Badges -->
                            <div class="card-badges">
                                 @if (item.IsNoiBat == true)
                                 {
                                     <span class="badge-pill badge-featured">⭐ Nổi Bật</span>
                                 }
                                 @if (item.IsHienThi == true)
                                 {
                                     <span class="badge-pill badge-active">Hiển thị</span>
                                 }
                                 else
                                 {
                                     <span class="badge-pill badge-hidden">Đang Ẩn</span>
                                 }
                            </div>
                        </div>
                        
                        <!-- Content Area -->
                        <div class="card-content">
                            <h3 class="news-title" title="@item.TieuDe">
                                @item.TieuDe
                            </h3>
                            <p class="news-desc">
                                 @(string.IsNullOrWhiteSpace(item.MoTaNgan) ? "Không có mô tả ngắn" : item.MoTaNgan)
                            </p>
                            <div class="news-meta">
                                <span class="flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    @(item.NgayDang?.ToString("dd/MM/yyyy") ?? "N/A")
                                </span>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Action Bar -->
                    <div class="action-bar">
                         <a href="@Url.Action("Edit", "TinTuc", new { area = "Admin_65133141", id = item.TinTucID })" class="btn-edit">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            Sửa
                        </a>
                        <div class="flex gap-2">
                            <button type="button" 
                                    class="btn-delete" 
                                    title="Xóa" 
                                    onclick="showConfirmDeleteNews(@item.TinTucID, '@Html.Raw(item.TieuDe?.Replace("'", "\\'"))')">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
        
        <!-- Pagination -->
        if (ViewBag.TotalPages > 1)
        {
            <div class="pagination-container">
                @if (ViewBag.CurrentPage > 1)
                {
                     <a href="@Url.Action("Index", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search })" class="page-link">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                     </a>
                }
                
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <a href="@Url.Action("Index", new { page = i, search = ViewBag.Search })" class="page-link @(i == ViewBag.CurrentPage ? "active" : "")">
                        @i
                    </a>
                }
                
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                     <a href="@Url.Action("Index", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search })" class="page-link">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                     </a>
                }
            </div>
        }
    }
    else
    {
        <div class="empty-state">
            <div class="w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-12 h-12 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Chưa có bài viết nào</h3>
            <p class="text-gray-500 mb-6">Hãy tạo bài viết đầu tiên để chia sẻ thông tin đến khách hàng.</p>
            <a href="@Url.Action("Create", "TinTuc", new { area = "Admin_65133141" })" class="btn-search text-decoration-none inline-block">Thêm bài viết mới</a>
        </div>
    }
</div>

<script>
    // --- NEWS SEARCH with GOOGLE-LIKE AUTOCOMPLETE ---
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('newsSearchInput');
        const suggestionsBox = document.getElementById('searchSuggestions');
        if (!searchInput || !suggestionsBox) return;

        let allNews = [];
        
        // Build news list from DOM
        function buildNewsList() {
            const newsCards = document.querySelectorAll('[id^="news-card-"]');
            allNews = [];
            
            newsCards.forEach(function (card) {
                const titleEl = card.querySelector('.news-title');
                if (titleEl) {
                    allNews.push({
                        id: card.id,
                        title: titleEl.textContent.trim(),
                        card: card
                    });
                }
            });
        }
        
        buildNewsList();

        // Show autocomplete suggestions
        function showSuggestions(searchTerm) {
            if (!searchTerm || searchTerm.length < 1) {
                suggestionsBox.classList.add('hidden');
                return;
            }

            // Filter matches
            const matches = allNews.filter(function (news) {
                return news.title.toLowerCase().includes(searchTerm.toLowerCase());
            }).slice(0, 6); // Limit to 6 suggestions

            if (matches.length === 0) {
                suggestionsBox.classList.add('hidden');
                return;
            }

            // Build suggestions HTML
            let html = '';
            matches.forEach(function (news) {
                const highlightedTitle = highlightMatch(news.title, searchTerm);
                html += `
                        <div class="suggestion-item px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 flex items-center gap-3 transition-colors"
                             data-news-id="${news.id}">
                            <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                            </svg>
                            <span class="text-sm text-gray-700 flex-1 line-clamp-1">${highlightedTitle}</span>
                        </div>
                `;
            });

            suggestionsBox.innerHTML = html;
            suggestionsBox.classList.remove('hidden');

            // Add click handlers to suggestions
            const suggestionItems = suggestionsBox.querySelectorAll('.suggestion-item');
            suggestionItems.forEach(function (item) {
                item.addEventListener('click', function () {
                    const newsId = this.getAttribute('data-news-id');
                    searchInput.value = this.textContent.trim();
                    performClientSearch(searchInput.value);
                    suggestionsBox.classList.add('hidden');
                });
            });
        }

        // Highlight matching text - Case Insensitive
        function highlightMatch(text, searchTerm) {
            if (!searchTerm) return text;
            const safeTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); 
            const regex = new RegExp(`(${safeTerm})`, 'gi');
            return text.replace(regex, '<strong class="font-semibold text-gray-900">$1</strong>');
        }

        // Perform Client-side Search (Filter visible cards)
        function performClientSearch(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            const newsCards = document.querySelectorAll('[id^="news-card-"]');
            let hasVisible = false;

            newsCards.forEach(function (card) {
                const titleEl = card.querySelector('.news-title');
                if (!titleEl) return;
                const titleText = titleEl.textContent.toLowerCase();

                if (term === '' || titleText.includes(term)) {
                    card.style.display = ''; 
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                    hasVisible = true;
                } else {
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.95)';
                    setTimeout(function () {
                        if (card.style.opacity === '0') {
                            card.style.display = 'none';
                        }
                    }, 200);
                }
            });
            
            // "No Results" message handling
            let noResultsMsg = document.getElementById('clientNoResults');
            const newsGrid = document.getElementById('newsGrid');
            
            if (!hasVisible && term !== '') {
                if (!noResultsMsg && newsGrid) {
                    noResultsMsg = document.createElement('div');
                    noResultsMsg.id = 'clientNoResults';
                    noResultsMsg.className = 'col-span-full text-center py-12';
                    noResultsMsg.innerHTML = `
                         <div class="flex flex-col items-center justify-center">
                            <svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-gray-500 text-lg font-semibold">Không tìm thấy tin tức nào</p>
                            <p class="text-gray-400 text-sm mt-1">Thử từ khóa khác hoặc xóa bộ lọc</p>
                        </div>
                    `;
                    newsGrid.appendChild(noResultsMsg);
                }
                if(noResultsMsg) noResultsMsg.style.display = 'block';
            } else {
                if(noResultsMsg) noResultsMsg.style.display = 'none';
            }
        }

        // Input event
        searchInput.addEventListener('input', function (e) {
            const searchTerm = e.target.value.trim();
            showSuggestions(searchTerm);
            performClientSearch(searchTerm);
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', function (e) {
            if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                suggestionsBox.classList.add('hidden');
            }
        });
    });
</script>

<!-- Modal xác nhận xóa tin tức (giống Employee) -->
<div id="confirmDeleteNewsModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-[9999] p-4" style="display: none;">
    <div class="bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-md w-full mx-auto transform transition-all">
        <div class="p-4 sm:p-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-red-100 flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </div>
                </div>
                <div class="ml-3 sm:ml-4 flex-1 min-w-0">
                    <h3 id="confirmDeleteNewsTitle" class="text-base sm:text-lg font-bold text-gray-900">Xóa tin tức</h3>
                    <p id="confirmDeleteNewsMessage" class="mt-2 text-sm text-gray-600 break-words">Bạn có chắc chắn muốn xóa bài viết này không? Hành động này không thể hoàn tác.</p>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 px-4 sm:px-6 py-3 sm:py-4 rounded-b-xl sm:rounded-b-2xl flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3">
            <button type="button" id="cancelDeleteNewsBtn" onclick="closeConfirmDeleteNewsModal()" class="px-4 sm:px-5 py-2 sm:py-2.5 bg-white hover:bg-gray-100 active:bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm border border-gray-300 shadow-sm hover:shadow-md active:shadow-sm transition-all transform hover:scale-105 active:scale-95 w-full sm:w-auto">Hủy</button>
            <button type="button" id="confirmDeleteNewsBtn" onclick="performDeleteNews()" class="px-4 sm:px-5 py-2 sm:py-2.5 bg-red-600 hover:bg-red-700 active:bg-red-800 text-white rounded-lg font-semibold text-sm shadow-md hover:shadow-lg active:shadow-md transition-all transform hover:scale-105 active:scale-95 w-full sm:w-auto">Xóa</button>
        </div>
    </div>
</div>

@Html.AntiForgeryToken()

<script>
    // --- NEWS DELETE MODAL FUNCTIONS ---
    var currentDeleteNewsId = null;
    var currentDeleteNewsTitle = null;

    function showConfirmDeleteNews(newsId, newsTitle) {
        currentDeleteNewsId = newsId;
        currentDeleteNewsTitle = newsTitle || 'bài viết này';
        
        var modal = document.getElementById('confirmDeleteNewsModal');
        var titleEl = document.getElementById('confirmDeleteNewsTitle');
        var msgEl = document.getElementById('confirmDeleteNewsMessage');
        
        if (!modal) {
            console.error('Delete modal not found');
            return;
        }
        
        if (titleEl) titleEl.textContent = 'Xóa tin tức';
        if (msgEl) msgEl.textContent = 'Bạn có chắc chắn muốn xóa "' + currentDeleteNewsTitle + '" không? Hành động này không thể hoàn tác.';
        
        modal.style.display = 'flex';
    }

    function closeConfirmDeleteNewsModal() {
        var modal = document.getElementById('confirmDeleteNewsModal');
        if (modal) {
            modal.style.display = 'none';
        }
        currentDeleteNewsId = null;
        currentDeleteNewsTitle = null;
    }

    function performDeleteNews() {
        if (!currentDeleteNewsId) {
            closeConfirmDeleteNewsModal();
            return;
        }
        
        var deleteBtn = document.getElementById('confirmDeleteNewsBtn');
        if (deleteBtn) {
            deleteBtn.disabled = true;
            deleteBtn.textContent = 'Đang xóa...';
        }
        
        var token = document.querySelector('input[name="__RequestVerificationToken"]');
        var formData = new FormData();
        formData.append('TinTucID', currentDeleteNewsId);
        if (token) {
            formData.append('__RequestVerificationToken', token.value);
        }
        
        fetch('@Url.Action("Delete", "TinTuc", new { area = "Admin_65133141" })', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Server error: ' + response.status);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Remove card from DOM with animation
                var card = document.getElementById('news-card-' + currentDeleteNewsId);
                if (card) {
                    card.style.transition = 'opacity 0.3s, transform 0.3s';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.9)';
                    setTimeout(function() {
                        card.remove();
                    }, 300);
                }
                closeConfirmDeleteNewsModal();
                showNewsAlert('success', data.message || 'Xóa tin tức thành công!');
            } else {
                showNewsAlert('error', data.message || 'Có lỗi xảy ra khi xóa tin tức.');
                if (deleteBtn) {
                    deleteBtn.disabled = false;
                    deleteBtn.textContent = 'Xóa';
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNewsAlert('error', 'Lỗi kết nối server. Vui lòng thử lại.');
            if (deleteBtn) {
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'Xóa';
            }
        });
    }

    // Alert function for News
    function showNewsAlert(type, message) {
        var alertContainer = document.getElementById('news-alert-container');
        if (!alertContainer) {
            alertContainer = document.createElement('div');
            alertContainer.id = 'news-alert-container';
            alertContainer.className = 'fixed top-4 right-4 z-[9999]';
            document.body.appendChild(alertContainer);
        }
        
        var alertId = 'alert-' + Date.now();
        var bgColor = type === 'success' ? 'bg-green-100 border-green-200 text-green-900' : 'bg-red-100 border-red-200 text-red-900';
        var iconBg = type === 'success' ? 'bg-green-500' : 'bg-red-500';
        var icon = type === 'success' 
            ? '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
            : '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
        
        var alertHTML = `
            <div id="${alertId}" class="${bgColor} px-4 py-2.5 rounded-xl shadow-md mb-3 flex items-center gap-3 min-w-[280px] max-w-md transform transition-all duration-300 translate-x-full border">
                <div class="w-7 h-7 rounded-full ${iconBg} text-white flex items-center justify-center flex-shrink-0">
                    ${icon}
                </div>
                <div class="flex-1">
                    <div class="font-semibold text-sm mb-0.5">${type === 'success' ? 'Thành công!' : 'Lỗi!'}</div>
                    <div class="text-sm leading-snug">${message}</div>
                </div>
                <button onclick="document.getElementById('${alertId}').remove()" class="text-current opacity-70 hover:opacity-100">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        `;
        
        alertContainer.insertAdjacentHTML('beforeend', alertHTML);
        
        setTimeout(function() {
            var alert = document.getElementById(alertId);
            if (alert) {
                alert.classList.remove('translate-x-full');
            }
        }, 10);
        
        setTimeout(function() {
            var alert = document.getElementById(alertId);
            if (alert) {
                alert.classList.add('translate-x-full');
                setTimeout(function() { alert.remove(); }, 300);
            }
        }, 5000);
    }
</script>
