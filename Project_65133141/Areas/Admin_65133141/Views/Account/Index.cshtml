@{
    ViewBag.Title = "Th√¥ng Tin T√†i Kho·∫£n";
    Layout = "~/Areas/Admin_65133141/Views/Shared/_Layout.cshtml";
    var userRole = Session["UserRole"] as string ?? "Nh√¢n vi√™n";
}
@model Project_65133141.Models.NhanVien

<div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Profile Card -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-pink-100">
                <div class="bg-gradient-to-r from-pink-500 to-rose-500 h-32 relative">
                    <div class="absolute -bottom-10 left-1/2 transform -translate-x-1/2">
                        <div class="w-24 h-24 rounded-full border-4 border-white bg-white shadow-lg flex items-center justify-center overflow-hidden">
                             @if (!string.IsNullOrEmpty(Model.Avatar))
                             {
                                 <img src="@Url.Content("~/Images/Employees/" + Model.Avatar)" alt="@Model.HoTen" class="w-full h-full object-cover">
                             }
                             else
                             {
                                 <div class="w-full h-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-3xl font-bold">
                                     @Model.HoTen.Substring(0, 1).ToUpper()
                                 </div>
                             }
                        </div>
                    </div>
                </div>
                
                <div class="pt-12 pb-8 px-6 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">@Model.HoTen</h2>
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-pink-100 text-pink-600">
                        @Model.VaiTro.TenVaiTro
                    </span>
                    
                    <div class="mt-6 flex flex-col space-y-3 text-left">
                        <div class="flex items-center text-gray-600 p-3 bg-gray-50 rounded-lg">
                            <span class="w-8 flex justify-center text-pink-500"><i class="fas fa-envelope"></i> @* Icon placeholder *@ üìß</span>
                            <span class="text-sm">@Model.Email</span>
                        </div>
                         <div class="flex items-center text-gray-600 p-3 bg-gray-50 rounded-lg">
                            <span class="w-8 flex justify-center text-pink-500">üì±</span>
                            <span class="text-sm">@Model.SDT</span>
                        </div>
                         <div class="flex items-center text-gray-600 p-3 bg-gray-50 rounded-lg">
                            <span class="w-8 flex justify-center text-pink-500">üìç</span>
                            <span class="text-sm">@(string.IsNullOrEmpty(Model.DiaChi) ? "Ch∆∞a c·∫≠p nh·∫≠t" : Model.DiaChi)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Change Password Form -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-2xl shadow-xl p-8 border border-pink-100">
                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center border-b pb-4">
                    <span class="bg-pink-100 p-2 rounded-lg text-pink-600 mr-3">üîí</span>
                    ƒê·ªïi M·∫≠t Kh·∫©u
                </h3>

                <form id="changePasswordForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
                        <input type="password" name="oldPassword" required
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors bg-gray-50 focus:bg-white"
                               placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i c·ªßa b·∫°n" />
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">M·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" name="newPassword" required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors bg-gray-50 focus:bg-white"
                                   placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                            <input type="password" name="confirmPassword" required
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors bg-gray-50 focus:bg-white"
                                   placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" />
                        </div>
                    </div>

                    <div id="passwordMessage" class="hidden p-4 rounded-lg text-sm font-medium"></div>

                    <div class="flex justify-end pt-4">
                        <button type="submit" 
                                class="px-6 py-3 bg-gradient-to-r from-pink-600 to-rose-600 text-white font-bold rounded-xl hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200">
                            C·∫≠p nh·∫≠t m·∫≠t kh·∫©u
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const form = this;
        const msgDiv = document.getElementById('passwordMessage');
        const submitBtn = form.querySelector('button[type="submit"]');
        
        // Reset message
        msgDiv.classList.add('hidden');
        msgDiv.className = 'hidden p-4 rounded-lg text-sm font-medium';
        
        // Disable button
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="inline-block animate-spin mr-2">‚Üª</span> ƒêang x·ª≠ l√Ω...';
        
        // Send AJAX request
        const formData = new FormData(form);
        
        fetch('@Url.Action("ChangePassword", "Account", new { area = "Admin_65133141" })', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            msgDiv.classList.remove('hidden');
            if (data.success) {
                msgDiv.classList.add('bg-green-100', 'text-green-700');
                msgDiv.innerHTML = '‚úÖ ' + data.message;
                form.reset();
            } else {
                msgDiv.classList.add('bg-red-100', 'text-red-700');
                msgDiv.innerHTML = '‚ö†Ô∏è ' + data.message;
            }
        })
        .catch(error => {
            msgDiv.classList.remove('hidden');
            msgDiv.classList.add('bg-red-100', 'text-red-700');
            msgDiv.innerHTML = '‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói k·∫øt n·ªëi.';
            console.error(error);
        })
        .finally(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = 'C·∫≠p nh·∫≠t m·∫≠t kh·∫©u';
        });
    });
</script>
