@model IEnumerable<Project_65133141.Models.DanhGia>
@{
    ViewBag.Title = "Quản lý Đánh giá";
    Layout = "~/Areas/Admin_65133141/Views/Shared/_Layout.cshtml";
}

<style>
    .review-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid #fee2e2;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }
    .review-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(220, 38, 38, 0.1);
        border-color: #fca5a5;
    }
    .star-rating {
        color: #f59e0b;
        font-size: 1.25rem;
    }
    .star-empty {
        color: #e5e7eb;
    }
    .filter-btn {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.875rem;
        font-weight: 600;
        border: 1px solid #e5e7eb;
        background: white;
        color: #6b7280;
        transition: all 0.2s;
        cursor: pointer;
        text-decoration: none;
    }
    .filter-btn:hover {
        border-color: #fca5a5;
        background: #fef2f2;
        text-decoration: none;
    }
    .filter-btn.active {
        background: #dc2626;
        border-color: #dc2626;
        color: white;
    }
    .avg-rating-box {
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        border: 1px solid #fecaca;
        border-radius: 16px;
        padding: 1.5rem;
    }
</style>

<div class="container mx-auto px-4 py-6">
    <!-- Alert Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div id="successAlert" class="bg-green-100 border border-green-200 text-green-800 px-4 py-3 rounded-xl mb-6 flex items-center justify-between shadow-sm">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <span class="font-medium">@TempData["SuccessMessage"]</span>
            </div>
            <button onclick="this.parentElement.remove()" class="text-green-600 hover:text-green-800">✕</button>
        </div>
        <script>setTimeout(function() { var el = document.getElementById('successAlert'); if(el) el.remove(); }, 5000);</script>
    }

    <!-- Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Quản lý Đánh giá</h1>
            <p class="text-gray-500 mt-1">Tổng cộng: <span class="font-semibold">@ViewBag.TotalItems</span> đánh giá</p>
        </div>
        
        <!-- Average Rating -->
        <div class="avg-rating-box flex items-center gap-4">
            <div class="text-center">
                <div class="text-3xl font-bold text-red-600">@ViewBag.AverageRating</div>
                <div class="text-xs text-gray-500">Điểm TB</div>
            </div>
            <div class="star-rating text-2xl">
                @for (int i = 1; i <= 5; i++)
                {
                    if (i <= Math.Round((double)ViewBag.AverageRating))
                    {
                        <span>★</span>
                    }
                    else
                    {
                        <span class="star-empty">★</span>
                    }
                }
            </div>
        </div>
    </div>

    <!-- Filters & Search -->
    <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-6">
        <!-- Star Filter -->
        <div class="flex flex-wrap items-center gap-3">
            <span class="text-sm font-medium text-gray-600">Lọc theo sao:</span>
            <a href="@Url.Action("Index", new { search = ViewBag.Search })" 
               class="filter-btn @(ViewBag.FilterStar == null ? "active" : "")">Tất cả</a>
            @for (int star = 5; star >= 1; star--)
            {
                <a href="@Url.Action("Index", new { filterStar = star, search = ViewBag.Search })" 
                   class="filter-btn @(ViewBag.FilterStar != null && (int)ViewBag.FilterStar == star ? "active" : "")">
                    @star ★
                </a>
            }
        </div>
        
        <!-- Search Box (Google-like) -->
        <div class="relative w-full sm:w-80">
            <form method="get" id="reviewSearchForm" class="m-0">
                @if (ViewBag.FilterStar != null)
                {
                    <input type="hidden" name="filterStar" value="@ViewBag.FilterStar" />
                }
                <input type="text" 
                       id="reviewSearchInput"
                       name="search" 
                       value="@ViewBag.Search"
                       placeholder="Tìm kiếm nội dung đánh giá..." 
                       autocomplete="off"
                       class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all shadow-sm">
                <button type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 bg-transparent border-none p-0 cursor-pointer">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </form>
            
            <!-- Suggestions Dropdown -->
            <div id="reviewSearchSuggestions" class="absolute top-full left-0 w-full mt-2 bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden z-50 hidden">
            </div>
        </div>
    </div>

    <!-- Reviews Grid -->
    <div id="reviewsGridContainer">
        @if (Model != null && Model.Any())
        {
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="reviewsGrid">
                @foreach (var item in Model)
                {
                    <div class="review-card group" id="review-@item.DanhGiaID">
                        <div class="p-5 flex-1">
                            <!-- Stars -->
                            <div class="star-rating mb-3">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= item.SoSao)
                                    {
                                        <span>★</span>
                                    }
                                    else
                                    {
                                        <span class="star-empty">★</span>
                                    }
                                }
                                <span class="text-sm text-gray-500 ml-2">(@item.SoSao/5)</span>
                            </div>
                            
                            <!-- Content -->
                            <p class="review-content text-gray-700 text-sm leading-relaxed mb-4 line-clamp-4">
                                @(string.IsNullOrWhiteSpace(item.NoiDung) ? "Không có nội dung" : item.NoiDung)
                            </p>
                            
                            <!-- Meta -->
                            <div class="flex items-center justify-between text-xs text-gray-400">
                                <span class="flex items-center gap-1">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    KH@(item.UserID.ToString("D4"))
                                </span>
                                <span>@(item.NgayDanhGia?.ToString("dd/MM/yyyy HH:mm") ?? "N/A")</span>
                            </div>
                        </div>
                        
                        <!-- Action Bar -->
                        <div class="bg-red-50 px-5 py-3 flex justify-end">
                            <button type="button" 
                                    onclick="showConfirmDeleteReview(@item.DanhGiaID)"
                                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-lg transition" 
                                    title="Xóa đánh giá">
                                Xóa
                            </button>
                        </div>
                    </div>
                }
            </div>
            
            <!-- Pagination -->
            if (ViewBag.TotalPages > 1)
            {
                <div class="flex flex-col items-center gap-4 mt-8">
                    <div class="flex items-center gap-2">
                        <!-- First Page -->
                        <a href="@(ViewBag.CurrentPage > 1 ? Url.Action("Index", new { page = 1, search = ViewBag.Search, filterStar = ViewBag.FilterStar }) : "#")" 
                           class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 @(ViewBag.CurrentPage > 1 ? "bg-white text-gray-500 hover:bg-gray-50 hover:text-red-600" : "bg-gray-50 text-gray-300 cursor-not-allowed") transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                        </a>

                        <!-- Previous Page -->
                        <a href="@(ViewBag.CurrentPage > 1 ? Url.Action("Index", new { page = ViewBag.CurrentPage - 1, search = ViewBag.Search, filterStar = ViewBag.FilterStar }) : "#")" 
                           class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 @(ViewBag.CurrentPage > 1 ? "bg-white text-gray-500 hover:bg-gray-50 hover:text-red-600" : "bg-gray-50 text-gray-300 cursor-not-allowed") transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </a>

                        <!-- Page Numbers -->
                        @for (int i = 1; i <= ViewBag.TotalPages; i++)
                        {
                            if (i == 1 || i == ViewBag.TotalPages || (i >= ViewBag.CurrentPage - 1 && i <= ViewBag.CurrentPage + 1))
                            {
                                <a href="@Url.Action("Index", new { page = i, search = ViewBag.Search, filterStar = ViewBag.FilterStar })" 
                                   class="w-10 h-10 flex items-center justify-center rounded-full font-semibold border transition-colors @(i == ViewBag.CurrentPage ? "bg-red-600 text-white border-red-600" : "bg-white border-gray-200 text-gray-600 hover:bg-gray-50 hover:text-red-600")">
                                    @i
                                </a>
                            }
                            else if (i == ViewBag.CurrentPage - 2 || i == ViewBag.CurrentPage + 2)
                            {
                                <span class="w-10 h-10 flex items-center justify-center text-gray-400">...</span>
                            }
                        }

                        <!-- Next Page -->
                        <a href="@(ViewBag.CurrentPage < ViewBag.TotalPages ? Url.Action("Index", new { page = ViewBag.CurrentPage + 1, search = ViewBag.Search, filterStar = ViewBag.FilterStar }) : "#")" 
                           class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 @(ViewBag.CurrentPage < ViewBag.TotalPages ? "bg-white text-gray-500 hover:bg-gray-50 hover:text-red-600" : "bg-gray-50 text-gray-300 cursor-not-allowed") transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </a>

                        <!-- Last Page -->
                        <a href="@(ViewBag.CurrentPage < ViewBag.TotalPages ? Url.Action("Index", new { page = ViewBag.TotalPages, search = ViewBag.Search, filterStar = ViewBag.FilterStar }) : "#")" 
                           class="w-10 h-10 flex items-center justify-center rounded-full border border-gray-200 @(ViewBag.CurrentPage < ViewBag.TotalPages ? "bg-white text-gray-500 hover:bg-gray-50 hover:text-red-600" : "bg-gray-50 text-gray-300 cursor-not-allowed") transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                        </a>
                    </div>

                    <!-- Page Status Text -->
                    <div class="text-gray-500 font-medium">
                        Trang @ViewBag.CurrentPage / @ViewBag.TotalPages
                    </div>
                </div>
            }
        }
        else
        {
            <div class="text-center py-16">
                <div class="w-20 h-20 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Chưa có đánh giá nào</h3>
                <p class="text-gray-500">Các đánh giá từ khách hàng sẽ hiển thị ở đây.</p>
            </div>
        }
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="confirmDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-[9999] p-4" style="display: none;">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-auto">
        <div class="p-6">
            <div class="flex items-start gap-4">
                <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </div>
                <div>
                    <h3 class="text-lg font-bold text-gray-900">Xóa đánh giá</h3>
                    <p class="mt-2 text-sm text-gray-600">Bạn có chắc chắn muốn xóa đánh giá này không? Hành động này không thể hoàn tác.</p>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 px-6 py-4 rounded-b-2xl flex justify-end gap-3">
            <button type="button" onclick="closeDeleteModal()" class="px-5 py-2.5 bg-white hover:bg-gray-100 text-gray-700 rounded-lg font-semibold text-sm border border-gray-300">Hủy</button>
            <button type="button" id="confirmDeleteBtn" onclick="performDelete()" class="px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold text-sm">Xóa</button>
        </div>
    </div>
</div>

@Html.AntiForgeryToken()

<script>
    // --- SEARCH & SUGGESTIONS LOGIC ---
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('reviewSearchInput');
        const suggestionsBox = document.getElementById('reviewSearchSuggestions');
        if (!searchInput || !suggestionsBox) return;

        let allReviews = [];

        // 1. Build list of reviews from DOM
        function buildReviewList() {
            const reviewCards = document.querySelectorAll('[id^="review-"]');
            allReviews = [];

            reviewCards.forEach(function (card) {
                const contentEl = card.querySelector('.review-content');
                if (contentEl) {
                    allReviews.push({
                        id: card.id, // e.g., "review-123"
                        content: contentEl.textContent.trim(),
                        card: card
                    });
                }
            });
        }

        buildReviewList();

        // 2. Show suggestions dropdown
        function showSuggestions(searchTerm) {
            if (!searchTerm || searchTerm.length < 1) {
                suggestionsBox.classList.add('hidden');
                return;
            }

            // Filter matches (limit 6)
            const matches = allReviews.filter(function (item) {
                return item.content.toLowerCase().includes(searchTerm.toLowerCase());
            }).slice(0, 6);

            if (matches.length === 0) {
                suggestionsBox.classList.add('hidden');
                return;
            }

            // Build HTML
            let html = '';
            matches.forEach(function (item) {
                const highlighted = highlightMatch(item.content, searchTerm);
                html += '<div class="suggestion-item px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 flex items-center gap-3 transition-colors" data-content="' + item.content.replace(/"/g, '&quot;') + '">' +
                            '<svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">' +
                                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>' +
                            '</svg>' +
                            '<span class="text-sm text-gray-700 flex-1 line-clamp-1">' + highlighted + '</span>' +
                        '</div>';
            });

            suggestionsBox.innerHTML = html;
            suggestionsBox.classList.remove('hidden');

            // Click handler
            const items = suggestionsBox.querySelectorAll('.suggestion-item');
            items.forEach(function(el) {
                el.addEventListener('click', function() {
                    const text = this.getAttribute('data-content');
                    searchInput.value = text;
                    suggestionsBox.classList.add('hidden');
                    performClientSearch(text);
                });
            });
        }

        // 3. Highlight match (case insensitive)
        function highlightMatch(text, term) {
            if (!term) return text;
            try {
                const safeTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp('(' + safeTerm + ')', 'gi');
                return text.replace(regex, '<strong class="font-semibold text-gray-900">$1</strong>');
            } catch (e) {
                return text;
            }
        }

        // 4. Perform client-side filter
        function performClientSearch(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            const reviewsGrid = document.getElementById('reviewsGrid');
            let hasVisible = false;

            allReviews.forEach(function (item) {
                if (term === '' || item.content.toLowerCase().includes(term)) {
                    item.card.style.display = '';
                    item.card.style.opacity = '1';
                    hasVisible = true;
                } else {
                    item.card.style.display = 'none';
                    item.card.style.opacity = '0';
                }
            });

            // Handle "No results" message
            let noRes = document.getElementById('clientNoResults');
            if (!hasVisible && term !== '') {
                if (!noRes && reviewsGrid) {
                    noRes = document.createElement('div');
                    noRes.id = 'clientNoResults';
                    noRes.className = 'col-span-full text-center py-12';
                    noRes.innerHTML = '<div class="flex flex-col items-center justify-center">' +
                            '<svg class="w-16 h-16 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' +
                            '<p class="text-gray-500 text-lg font-semibold">Không tìm thấy đánh giá nào</p>' +
                        '</div>';
                    reviewsGrid.parentElement.appendChild(noRes);
                }
                if (noRes) noRes.style.display = 'block';
            } else {
                if (noRes) noRes.style.display = 'none';
            }
        }

        // Input listeners
        searchInput.addEventListener('input', function(e) {
            const val = e.target.value;
            showSuggestions(val);
            performClientSearch(val);
        });

        // Close on outside click
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
                suggestionsBox.classList.add('hidden');
            }
        });
    });

    // --- DELETE LOGIC ---
    var currentDeleteId = null;

    function showConfirmDeleteReview(id) {
        currentDeleteId = id;
        document.getElementById('confirmDeleteModal').style.display = 'flex';
    }

    function closeDeleteModal() {
        document.getElementById('confirmDeleteModal').style.display = 'none';
        currentDeleteId = null;
    }

    function performDelete() {
        if (!currentDeleteId) return;
        
        var btn = document.getElementById('confirmDeleteBtn');
        btn.disabled = true;
        btn.innerHTML = '<svg class="animate-spin h-4 w-4 text-white inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Đang xóa...';
        
        var token = document.querySelector('input[name="__RequestVerificationToken"]');
        var formData = new FormData();
        formData.append('DanhGiaID', currentDeleteId);
        if (token) formData.append('__RequestVerificationToken', token.value);
        
        fetch('@Url.Action("Delete", "DanhGia", new { area = "Admin_65133141" })', {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                var card = document.getElementById('review-' + currentDeleteId);
                if (card) {
                    card.style.transition = 'opacity 0.3s, transform 0.3s';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.9)';
                }
                closeDeleteModal();
                showAlert('success', data.message);
                
                // Refresh page after short delay to update pagination
                setTimeout(function() {
                    window.location.reload();
                }, 1000);
            } else {
                showAlert('error', data.message);
                btn.disabled = false;
                btn.innerHTML = 'Xóa';
            }
        })
        .catch(function() {
            showAlert('error', 'Lỗi kết nối server');
            btn.disabled = false;
            btn.innerHTML = 'Xóa';
        });
    }

    function showAlert(type, message) {
        var alertContainer = document.getElementById('alert-container');
        if (!alertContainer) {
            alertContainer = document.createElement('div');
            alertContainer.id = 'alert-container';
            alertContainer.className = 'fixed top-4 right-4 z-[9999]';
            document.body.appendChild(alertContainer);
        }

        var alertId = 'alert-' + Date.now();
        var config = {
            success: {
                bg: 'bg-green-100 border border-green-200 text-green-900',
                iconBg: 'bg-green-500 text-white',
                title: 'Thành công!',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
            },
            error: {
                bg: 'bg-red-100 border border-red-200 text-red-900',
                iconBg: 'bg-red-500 text-white',
                title: 'Lỗi!',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M4.93 4.93l14.14 14.14"></path><circle cx="12" cy="12" r="9" stroke-width="2" fill="none"></circle></svg>'
            }
        };

        var cfg = config[type] || config.error;

        var alertHTML = `
            <div id="${alertId}" class="${cfg.bg} px-4 py-2.5 rounded-xl shadow-md mb-3 flex items-center gap-3 min-w-[280px] max-w-md transform transition-all duration-300 translate-x-full bg-opacity-95 border border-white/60">
                <div class="w-7 h-7 rounded-full ${cfg.iconBg} flex items-center justify-center flex-shrink-0">
                    ${cfg.icon}
                </div>
                <div class="flex-1">
                    <div class="font-semibold text-sm mb-0.5">${cfg.title}</div>
                    <div class="text-sm leading-snug">${message}</div>
                </div>
                <button onclick="document.getElementById('${alertId}').remove()" class="text-current opacity-70 hover:opacity-100">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        `;

        alertContainer.insertAdjacentHTML('beforeend', alertHTML);

        // Animate in
        setTimeout(function() {
            var alert = document.getElementById(alertId);
            if (alert) {
                alert.classList.remove('translate-x-full');
            }
        }, 10);

        // Auto remove
        setTimeout(function() {
            var alert = document.getElementById(alertId);
            if (alert) {
                alert.classList.add('translate-x-full');
                setTimeout(function() { alert.remove(); }, 300);
            }
        }, 5000);
    }
</script>
