@model IEnumerable<Project_65133141.Models.DatBan>

@{
    ViewBag.Title = "Quản lý đặt bàn";
    Layout = "~/Areas/Employee_65133141/Views/Shared/_Layout.cshtml";

    var searchString = ViewBag.SearchString as string;
    var statusFilter = ViewBag.StatusFilter as string;
    var currentPage = ViewBag.CurrentPage ?? 1;
    var totalPages = ViewBag.TotalPages ?? 1;
    var totalItems = ViewBag.TotalItems ?? 0;
    var statuses = ViewBag.Statuses as List<string> ?? new List<string>();
}

<!-- Alert Container (Fixed Top Right) -->
<div id="alertContainer" class="fixed top-20 right-4 z-[10000] space-y-2 max-w-md"></div>

<div class="container mx-auto px-4 py-6">
    <div class="mb-6 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-stone-800" style="font-family: 'Inter', sans-serif;">Quản lý đặt bàn</h1>
            <p class="text-stone-500 text-sm mt-1">Danh sách và quản lý các đặt bàn của nhà hàng</p>
        </div>
        <button type="button" onclick="openCreateDatBanModal()" 
                class="px-5 py-2.5 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white rounded-xl font-semibold flex items-center gap-2 transition-all shadow-lg shadow-amber-500/25 hover:shadow-amber-500/40 hover:-translate-y-0.5">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Đặt bàn mới
        </button>
    </div>

    <!-- Stats & Actions -->
    <div class="mb-6 flex items-center justify-between">
        <div class="text-stone-600">
            <p>Tổng số: <span class="font-bold text-amber-700">@totalItems</span> đặt bàn</p>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="mb-6 flex flex-wrap items-end gap-3 justify-end">
        @using (Html.BeginForm("Index", "DatBan", new { area = "Employee_65133141" }, FormMethod.Get, new { @class = "flex flex-wrap items-end gap-3" }))
        {
            <!-- Icon-only Filter Dropdown -->
            <div class="relative">
                <input type="hidden" name="statusFilter" id="statusFilterInput" value="@(string.IsNullOrEmpty(statusFilter) ? "all" : statusFilter)" />
                
                <button type="button" id="filterBtn" onclick="toggleFilterDropdown()" 
                        class="w-11 h-11 flex items-center justify-center rounded-xl border-2 border-stone-200 hover:border-amber-400 hover:bg-amber-50 text-stone-600 hover:text-amber-700 transition-all shadow-sm group bg-white"
                        title="Lọc theo trạng thái">
                    <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                    </svg>
                </button>

                <div id="filterDropdown" class="hidden absolute top-full right-0 mt-2 w-48 bg-white border border-stone-100 rounded-xl shadow-xl z-50 overflow-hidden animate-fade-in-down">
                    <div class="py-1">
                        <button type="button" onclick="selectStatus('all')" 
                                class="w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-amber-50 transition-colors flex items-center justify-between group @(string.IsNullOrEmpty(statusFilter) || statusFilter == "all" ? "text-amber-700 bg-amber-50/50" : "text-stone-600")">
                            <span>Tất cả trạng thái</span>
                            @if (string.IsNullOrEmpty(statusFilter) || statusFilter == "all") {
                                <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            }
                        </button>
                        @foreach (var status in statuses)
                        {
                            <button type="button" onclick="selectStatus('@status')" 
                                    class="w-full text-left px-4 py-2.5 text-sm font-medium hover:bg-amber-50 transition-colors flex items-center justify-between group @(statusFilter == status ? "text-amber-700 bg-amber-50/50" : "text-stone-600")">
                                <span>@status</span>
                                @if (statusFilter == status) {
                                    <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                }
                            </button>
                        }
                    </div>
                </div>
            </div>

            <div class="relative">
                <div class="flex items-center relative">
                    <input type="text" id="searchInput" name="searchString" value="@searchString"
                           placeholder="Tìm theo tên, SĐT, bàn..." autocomplete="off"
                           class="w-64 pl-10 pr-10 py-2.5 rounded-xl border-2 border-stone-200 focus:border-amber-400 focus:ring-2 focus:ring-amber-100 transition-all text-sm font-medium text-stone-700 placeholder-stone-400" />
                    
                    <!-- Search Icon -->
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-amber-600 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>

                    <!-- Loading Indicator -->
                    <div id="searchLoading" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2">
                         <svg class="animate-spin h-4 w-4 text-amber-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                             <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                             <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                         </svg>
                    </div>
                </div>
                
                <!-- Suggestions Dropdown -->
                <div id="searchSuggestions" class="hidden absolute top-full left-0 right-0 mt-1 bg-white border border-stone-200 rounded-lg shadow-xl z-50 max-h-60 overflow-y-auto"></div>
            </div>
        }
    </div>

    <!-- Table Container (Updated via AJAX) -->
    <div id="datban-list-container">
        @Html.Partial("~/Areas/Employee_65133141/Views/DatBan/_DatBanList.cshtml", Model)
    </div>
</div>

<!-- =========================================================================================
     MODAL: CHI TIẾT ĐẶT BÀN (DatBan Details)
     Style: Split Layout (Info Card + Details), Teal Theme
     ========================================================================================= -->
<div id="datBanDetailsModal" class="auth-modal-overlay" style="display: none;">
    <div class="auth-modal-container auth-modal-large" style="max-width: 800px; padding: 0;">
        <button type="button" class="auth-close-btn" onclick="closeDatBanDetailsModal()" style="position: absolute; top: 15px; right: 15px; background: white; border-radius: 50%; width: 32px; height: 32px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; color: #6b7280; z-index: 10;">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        
        <div class="flex flex-col md:flex-row h-full">
            <!-- Left: Info Card (Amber Gradient) -->
            <div class="w-full md:w-1/2 bg-gradient-to-br from-stone-50 to-amber-50 flex items-center justify-center p-6 border-r border-amber-100" style="min-height: 400px;">
                <div class="w-full max-w-sm">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-center mb-4">
                            <!-- Icon -->
                            <div class="w-20 h-20 bg-amber-100/80 rounded-full flex items-center justify-center mx-auto mb-3 border border-amber-200 shadow-sm">
                                <svg class="w-10 h-10 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-stone-800" id="detailDatBanId" style="font-family: 'Inter', sans-serif !important;">DB0000</h3>
                            <p class="text-sm text-gray-500 mt-1">Mã đặt bàn</p>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider block mb-1">Trạng thái</span>
                                <span id="detailDatBanStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase">-</span>
                            </div>
                            <div>
                                <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider block mb-1">Số người</span>
                                <span class="text-sm font-semibold text-gray-800" id="detailDatBanSoNguoi">-</span>
                            </div>
                            <div>
                                <span class="text-xs font-semibold text-gray-400 uppercase tracking-wider block mb-1">Thời gian đến</span>
                                <span class="text-sm font-semibold text-gray-800" id="detailDatBanThoiGian">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Details -->
            <div class="w-full md:w-1/2 p-8 flex flex-col justify-between">
                <div>
                   <!-- Header -->
                   <div class="flex items-start justify-between mb-4">
                       <div>
                           <h2 class="text-3xl font-bold text-stone-900 mb-2 leading-tight" id="detailDatBanKhachHang" style="font-family: 'Inter', sans-serif !important;">-</h2>
                           <div class="flex gap-2">
                               <span id="detailDatBanStatusBadge" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-bold uppercase tracking-wide">-</span>
                           </div>
                       </div>
                   </div>

                   <!-- Details Grid -->
                   <div class="grid grid-cols-1 gap-y-6 mb-8">
                       <div>
                           <span class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Số điện thoại</span>
                           <span class="block text-sm font-semibold text-gray-800" id="detailDatBanSDT">-</span>
                       </div>
                       <div>
                           <span class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Bàn</span>
                           <span class="block text-sm font-semibold text-gray-800" id="detailDatBanBan">-</span>
                       </div>
                       <div>
                           <span class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Ngày tạo</span>
                           <span class="block text-sm font-semibold text-gray-800" id="detailDatBanNgayTao">-</span>
                       </div>
                       <div id="detailDatBanGhiChuContainer" class="hidden">
                           <span class="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1">Ghi chú</span>
                           <p class="text-sm text-gray-600 leading-relaxed" id="detailDatBanGhiChu">-</p>
                       </div>
                   </div>
                </div>

                <!-- Footer Buttons -->
                <div class="flex items-center gap-3 mt-auto">
                    <button type="button" onclick="openEditFromDetails()" class="flex-1 px-4 py-2.5 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white rounded-xl font-bold text-sm transition-all shadow-md hover:shadow-lg transform active:scale-95 flex items-center justify-center gap-2 shadow-amber-500/20">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                        Sửa đặt bàn
                    </button>
                    <button type="button" onclick="closeDatBanDetailsModal()" class="px-6 py-2.5 bg-gray-50 border border-gray-200 text-gray-700 rounded-xl font-bold text-sm hover:bg-gray-100 transition-all active:scale-95">
                        Đóng
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- =========================================================================================
     MODAL: CẬP NHẬT ĐẶT BÀN (Edit DatBan)
     Style: Auth Form Modal, Teal Theme
     ========================================================================================= -->
<div id="editDatBanModal" class="auth-modal-overlay" style="display: none;">
    <div class="auth-modal-container auth-modal-large" style="max-width: 800px; position: relative;">
        <button type="button" class="auth-close-btn" onclick="closeEditDatBanModal()" style="position: absolute; top: 15px; right: 15px; background: white; border-radius: 50%; width: 32px; height: 32px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 20; color: #6b7280; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer;">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <div class="auth-modal-header">
            <div class="auth-logo" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); color: #b45309; border: 1px solid rgba(212,175,55,0.2);">
                <svg class="w-full h-full p-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
            </div>
            <h2 class="auth-modal-title">Cập nhật đặt bàn</h2>
            <p class="auth-modal-subtitle">Chỉnh sửa thông tin đặt bàn của khách hàng</p>
        </div>

        <div class="auth-modal-body">
            @using (Html.BeginForm("Edit", "DatBan", new { area = "Employee_65133141" }, FormMethod.Post, new { id = "editDatBanForm" }))
            {
                @Html.AntiForgeryToken()
                <input type="hidden" name="DatBanID" id="editDatBanID" />

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Column 1 -->
                    <div class="space-y-4">
                         <div class="auth-form-group">
                            <label class="auth-form-label">Họ tên khách hàng <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="text" name="HoTenKhach" id="editHoTenKhach" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" required />
                            </div>
                        </div>

                         <div class="auth-form-group">
                            <label class="auth-form-label">Bàn ăn</label>
                            <div class="auth-input-wrapper">
                                <select name="BanID" id="editBanID" class="auth-form-control focus:border-amber-500 focus:ring-amber-200">
                                    <option value="">-- Chọn bàn --</option>
                                    <!-- Populated via JS -->
                                </select>
                            </div>
                        </div>

                        <div class="auth-form-group">
                            <label class="auth-form-label">Thời gian đến <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="datetime-local" name="ThoiGianDen" id="editThoiGianDen" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" required />
                            </div>
                        </div>
                    </div>

                    <!-- Column 2 -->
                    <div class="space-y-4">
                         <div class="auth-form-group">
                            <label class="auth-form-label">Số điện thoại <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="tel" name="SDTKhach" id="editSDTKhach" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" required />
                            </div>
                        </div>

                         <div class="auth-form-group">
                            <label class="auth-form-label">Số người</label>
                            <div class="auth-input-wrapper">
                                <input type="number" name="SoNguoi" id="editSoNguoi" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" min="1" />
                            </div>
                        </div>

                        <div class="auth-form-group">
                            <label class="auth-form-label">Trạng thái <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <select name="TrangThai" id="editTrangThai" class="auth-form-control focus:border-amber-500 focus:ring-amber-200">
                                    <option value="Chờ xác nhận">Chờ xác nhận</option>
                                    <option value="Đã xác nhận">Đã xác nhận</option>
                                    <option value="Đang phục vụ">Đang phục vụ</option>
                                    <option value="Hoàn thành">Hoàn thành</option>
                                    <option value="Đã hủy">Đã hủy</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="auth-form-group mt-4">
                    <label class="auth-form-label">Ghi chú</label>
                    <div class="auth-input-wrapper">
                        <textarea name="GhiChu" id="editGhiChu" rows="3" class="auth-form-control focus:border-amber-500 focus:ring-amber-200"></textarea>
                    </div>
                </div>

                <div class="auth-btn-group mt-6">
                    <button type="button" class="auth-btn auth-btn-cancel" onclick="closeEditDatBanModal()">Hủy</button>
                    <button type="submit" class="auth-btn auth-btn-submit bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 shadow-amber-500/30">Lưu thay đổi</button>
                </div>
            }
</div>
    </div>
</div>

<!-- =========================================================================================
     MODAL: TẠO ĐẶT BÀN MỚI (Create Offline Reservation)
     Style: Auth Form Modal, Teal Theme
     ========================================================================================= -->
<div id="createDatBanModal" class="auth-modal-overlay" style="display: none;">
    <div class="auth-modal-container auth-modal-large" style="max-width: 800px; position: relative;">
        <button type="button" class="auth-close-btn" onclick="closeCreateDatBanModal()" style="position: absolute; top: 15px; right: 15px; background: white; border-radius: 50%; width: 32px; height: 32px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 20; color: #6b7280; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer;">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <div class="auth-modal-header">
            <div class="auth-logo" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); color: #b45309; border: 1px solid rgba(212,175,55,0.2);">
                <svg class="w-full h-full p-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h2 class="auth-modal-title">Đặt bàn offline</h2>
            <p class="auth-modal-subtitle">Tạo đặt bàn cho khách hàng walk-in hoặc qua điện thoại</p>
        </div>

        <div class="auth-modal-body">
            <form id="createDatBanForm" method="post" action="@Url.Action("Create", "DatBan", new { area = "Employee_65133141" })">
                @Html.AntiForgeryToken()

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Column 1 -->
                    <div class="space-y-4">
                         <div class="auth-form-group">
                            <label class="auth-form-label">Họ tên khách hàng <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="text" name="customerName" id="createCustomerName" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" required />
                            </div>
                        </div>

                         <div class="auth-form-group">
                            <label class="auth-form-label">Email</label>
                            <div class="auth-input-wrapper">
                                <input type="email" name="customerEmail" id="createCustomerEmail" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" />
                            </div>
                        </div>

                        <div class="auth-form-group">
                            <label class="auth-form-label">Thời gian đến <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="datetime-local" name="ThoiGianDen" id="createThoiGianDen" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" required />
                            </div>
                        </div>
                    </div>

                    <!-- Column 2 -->
                    <div class="space-y-4">
                         <div class="auth-form-group">
                            <label class="auth-form-label">Số điện thoại <span class="auth-required">*</span></label>
                            <div class="auth-input-wrapper">
                                <input type="tel" name="customerPhone" id="createCustomerPhone" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" pattern="[0-9]{10}" required />
                                <small class="text-gray-500 text-xs mt-1 block">10 chữ số</small>
                            </div>
                        </div>

                         <div class="auth-form-group">
                            <label class="auth-form-label">Số người</label>
                            <div class="auth-input-wrapper">
                                <input type="number" name="datBan.SoNguoi" id="createSoNguoi" class="auth-form-control focus:border-amber-500 focus:ring-amber-200" min="1" value="2" />
                            </div>
                        </div>

                        <div class="auth-form-group">
                            <label class="auth-form-label">Bàn ăn</label>
                            <div class="auth-input-wrapper">
                                <select name="datBan.BanID" id="createBanID" class="auth-form-control focus:border-amber-500 focus:ring-amber-200">
                                    <option value="">-- Chọn bàn --</option>
                                    <!-- Populated via JS -->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="auth-form-group mt-4">
                    <label class="auth-form-label">Ghi chú</label>
                    <div class="auth-input-wrapper">
                        <textarea name="datBan.GhiChu" id="createGhiChu" rows="3" class="auth-form-control focus:border-amber-500 focus:ring-amber-200"></textarea>
                    </div>
                </div>

                <div class="auth-btn-group mt-6">
                    <button type="button" class="auth-btn auth-btn-cancel" onclick="closeCreateDatBanModal()">Hủy</button>
                    <button type="submit" class="auth-btn auth-btn-submit bg-gradient-to-r from-teal-500 to-emerald-600 hover:from-teal-600 hover:to-emerald-700 shadow-teal-500/30">Đặt bàn</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // ==========================================================
    // ALERT SYSTEM (Matched with Admin)
    // ==========================================================
    function showAlert(type, message) {
        var container = document.getElementById('alertContainer');
        if (!container) return;

        var alertId = 'alert-' + Date.now();

        var config = {
            success: {
                bg: 'bg-green-100 border border-green-200 text-green-900',
                iconBg: 'bg-green-500 text-white',
                title: 'Thành công!',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>'
            },
            error: {
                bg: 'bg-red-100 border border-red-200 text-red-900',
                iconBg: 'bg-red-500 text-white',
                title: 'Lỗi!',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M4.93 4.93l14.14 14.14"></path><circle cx="12" cy="12" r="9" stroke-width="2" fill="none"></circle></svg>'
            },
            warning: {
                bg: 'bg-amber-100 border border-amber-200 text-amber-900',
                iconBg: 'bg-amber-500 text-white',
                title: 'Cảnh báo!',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 3h.01M10.29 4.21l-6.6 11.45A1 1 0 004.53 18h14.94a1 1 0 00.86-1.5l-6.6-11.45a1 1 0 00-1.74 0z"/></svg>'
            },
            info: {
                bg: 'bg-sky-100 border border-sky-200 text-sky-900',
                iconBg: 'bg-sky-500 text-white',
                title: 'Thông tin',
                icon: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01" /><circle cx="12" cy="12" r="9" stroke-width="2" fill="none"></circle></svg>'
            }
        };

        var cfg = config[type] || config.info;

        var html = `
        <div id="${alertId}" class="${cfg.bg} px-3 py-2 rounded-lg shadow-md flex items-center gap-2 max-w-md transition-all duration-300 translate-x-full bg-opacity-95 border border-white/60">
            <div class="w-7 h-7 rounded-full ${cfg.iconBg} flex items-center justify-center flex-shrink-0">
                ${cfg.icon}
            </div>
            <div class="flex-1">
                <div class="font-semibold text-sm mb-0.5">${cfg.title}</div>
                <div class="text-sm leading-snug">${message}</div>
            </div>
            <button type="button" class="ml-2 text-current/70 hover:text-current" aria-label="Đóng thông báo"
                    onclick="(function(){ var el = document.getElementById('${alertId}'); if(el){ el.classList.add('translate-x-full'); setTimeout(function(){ el.remove(); }, 250); } })()">
                &#10005;
            </button>
        </div>`;

        container.insertAdjacentHTML('beforeend', html);

        setTimeout(function () {
            var el = document.getElementById(alertId);
            if (el) el.classList.remove('translate-x-full');
        }, 10);

        setTimeout(function () {
            var el = document.getElementById(alertId);
            if (el) {
                el.classList.add('translate-x-full');
                setTimeout(function () { el.remove(); }, 250);
            }
        }, 4000);
    }
    
    // Global variable to store current ID for switching between modals
    var currentDetailDatBanId = 0;

    // ==========================================================
    // CREATE MODAL LOGIC
    // ==========================================================
    function openCreateDatBanModal() {
        var modal = document.getElementById('createDatBanModal');
        if (!modal) return;

        // Reset form
        document.getElementById('createDatBanForm').reset();
        
        // Set default arrival time (now + 1 hour)
        var now = new Date();
        now.setHours(now.getHours() + 1);
        var datetime = now.toISOString().slice(0, 16);
        document.getElementById('createThoiGianDen').value = datetime;

        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';

        // Load available tables for current time
        loadAvailableTablesForCreate(datetime);
    }

    function closeCreateDatBanModal() {
        var modal = document.getElementById('createDatBanModal');
        if(modal) modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function loadAvailableTablesForCreate(datetime) {
        var select = document.getElementById('createBanID');
        select.innerHTML = '<option value="">Đang tải...</option>';

        // Convert datetime-local format to proper URL-friendly format
        var dateObj = new Date(datetime);
        var formattedDate = dateObj.getFullYear() + '-' + 
                           String(dateObj.getMonth() + 1).padStart(2, '0') + '-' + 
                           String(dateObj.getDate()).padStart(2, '0') + ' ' +
                           String(dateObj.getHours()).padStart(2, '0') + ':' +
                           String(dateObj.getMinutes()).padStart(2, '0') + ':00';

        var url = '@Url.Action("GetAvailableTables", "DatBan", new { area = "Employee_65133141" })';
        url += '?arrivalTime=' + encodeURIComponent(formattedDate) + '&t=' + new Date().getTime();

        fetch(url)
            .then(res => {
                if (!res.ok) {
                    throw new Error('HTTP ' + res.status);
                }
                return res.json();
            })
            .then(tables => {
                select.innerHTML = '<option value="">-- Chọn bàn --</option>';
                if (tables && Array.isArray(tables)) {
                    if (tables.length === 0) {
                        select.innerHTML += '<option value="" disabled>Không có bàn trống</option>';
                    }
                    tables.forEach(t => {
                        var option = document.createElement('option');
                        option.value = t.BanID;
                        option.text = `${t.TenBan} (${t.SucChua} ghế) - ${t.ViTri || 'N/A'}`;
                        option.dataset.capacity = t.SucChua;
                        select.appendChild(option);
                    });
                    setTimeout(function() { filterTables('createSoNguoi', 'createBanID'); }, 100);
                } else {
                    select.innerHTML = '<option value="">-- Không có dữ liệu --</option>';
                }
            })
            .catch(err => {
                console.error('Error loading tables:', err);
                select.innerHTML = '<option value="">-- Lỗi: ' + err.message + ' --</option>';
                showAlert('error', 'Không thể tải danh sách bàn. Vui lòng thử lại.');
            });
    }

    // Update available tables when arrival time changes
    document.addEventListener('DOMContentLoaded', function() {
        var timeInput = document.getElementById('createThoiGianDen');
        if (timeInput) {
            timeInput.addEventListener('change', function() {
                loadAvailableTablesForCreate(this.value);
            });
        }
        
        // Filter tables listeners
        var createPeople = document.getElementById('createSoNguoi');
        if(createPeople) {
             createPeople.addEventListener('input', function() { filterTables('createSoNguoi', 'createBanID'); });
        }
        var editPeople = document.getElementById('editSoNguoi');
        if(editPeople) {
             editPeople.addEventListener('input', function() { filterTables('editSoNguoi', 'editBanID'); });
        }
    });

    function filterTables(inputId, selectId) {
        var input = document.getElementById(inputId);
        var select = document.getElementById(selectId);
        if(!input || !select) return;

        var guests = parseInt(input.value) || 0;
        var options = Array.from(select.options);
        var hasSelection = false;
        var currentSelected = select.value;
        var firstValid = null;

        options.forEach(function(opt) {
            if (!opt.value) return; 
            var cap = parseInt(opt.dataset.capacity) || 0;
            if (guests > 0 && cap < guests) {
                opt.hidden = true;
                opt.disabled = true;
            } else {
                opt.hidden = false;
                opt.disabled = false;
                if (!firstValid) firstValid = opt.value;
            }
            if (opt.value == currentSelected && !opt.disabled) hasSelection = true;
        });

        if ((!hasSelection || !currentSelected) && firstValid) {
            select.value = firstValid;
        } else if (!hasSelection && currentSelected) {
            if (firstValid) select.value = firstValid;
            else select.value = "";
        }
    }

    // Handle Create Form Submit
    document.getElementById('createDatBanForm').addEventListener('submit', function(e) {
        e.preventDefault();
        var form = this;
        var formData = new FormData(form);
        var btn = form.querySelector('button[type="submit"]');
        var originalText = btn.textContent;
        
        btn.disabled = true;
        btn.textContent = 'Đang xử lý...';

        fetch(form.action, {
            method: 'POST',
            body: formData
        })
        .then(res => res.text())
        .then(html => {
            // Check if response is redirect (success) or form with errors
            if (html.indexOf('ErrorMessage') > -1 || html.indexOf('Lỗi') > -1) {
                // Has errors - reload to show TempData error
                window.location.reload();
            } else {
                // Success
                closeCreateDatBanModal();
                showAlert('success', 'Đặt bàn thành công!');
                setTimeout(() => window.location.reload(), 1000);
            }
        })
        .catch(err => {
            console.error(err);
            showAlert('error', 'Có lỗi xảy ra khi đặt bàn.');
            btn.disabled = false;
            btn.textContent = originalText;
        });
    });

    // ==========================================================
    // DETAILS MODAL LOGIC
    // ==========================================================
    function openDatBanDetailsModal(id) {
        currentDetailDatBanId = id; // Store ID
        var modal = document.getElementById('datBanDetailsModal');
        if (!modal) return;

        // Reset text
        document.getElementById('detailDatBanKhachHang').textContent = 'Đang tải...';
        
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';

        // Fetch Data
        fetch('@Url.Action("GetDatBanDetails", "DatBan", new { area = "Employee_65133141" })/' + id)
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    populateDatBanDetails(data.data);
                } else {
                    showAlert('error', data.message);
                    closeDatBanDetailsModal();
                }
            })
            .catch(err => {
                console.error(err);
                showAlert('error', 'Có lỗi xảy ra khi tải thông tin.');
                closeDatBanDetailsModal();
            });
    }

    function populateDatBanDetails(d) {
        document.getElementById('detailDatBanId').textContent = 'DB' + d.DatBanID.toString().padStart(4, '0');
        document.getElementById('detailDatBanKhachHang').textContent = d.HoTenKhach || 'N/A';
        document.getElementById('detailDatBanSDT').textContent = d.SDTKhach || 'N/A';
        document.getElementById('detailDatBanSoNguoi').textContent = (d.SoNguoi || 0) + ' người';
        
        // Date Format
        let timeStr = '-';
        if (d.ThoiGianDen) {
            // Try to parse JSON date format /Date(123456)/ or ISO string
            let date;
            if (typeof d.ThoiGianDen === 'string' && d.ThoiGianDen.indexOf('/Date') >= 0) {
                 date = new Date(parseInt(d.ThoiGianDen.replace(/\/Date\((-?\d+)\)\//, '$1')));
            } else {
                 date = new Date(d.ThoiGianDen);
            }

            if(!isNaN(date.getTime())) {
                timeStr = date.toLocaleString('vi-VN', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric' });
            }
        }
        document.getElementById('detailDatBanThoiGian').textContent = timeStr;

        let createdStr = '-';
        if (d.NgayTao) {
             let date;
            if (typeof d.NgayTao === 'string' && d.NgayTao.indexOf('/Date') >= 0) {
                 date = new Date(parseInt(d.NgayTao.replace(/\/Date\((-?\d+)\)\//, '$1')));
            } else {
                 date = new Date(d.NgayTao);
            }

            if(!isNaN(date.getTime())) {
                createdStr = date.toLocaleString('vi-VN', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit', year: 'numeric' });
            }
        }
        document.getElementById('detailDatBanNgayTao').textContent = createdStr;

        // Info
        document.getElementById('detailDatBanBan').textContent = d.BanAn || 'Chưa chọn';
        
        // Status
        var statusEl = document.getElementById('detailDatBanStatus');
        var statusBadge = document.getElementById('detailDatBanStatusBadge');
        var status = d.TrangThai || 'Chờ xác nhận';
        
        statusEl.textContent = status;
        statusBadge.textContent = status;
        
        // Colors
        let cls = 'px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide ';
        if (status === 'Đã xác nhận') cls += 'bg-green-100 text-green-700';
        else if (status === 'Đang phục vụ') cls += 'bg-blue-100 text-blue-700';
        else if (status === 'Hoàn thành') cls += 'bg-purple-100 text-purple-700';
        else if (status === 'Đã hủy') cls += 'bg-red-100 text-red-700';
        else cls += 'bg-gray-100 text-gray-700';
        
        statusEl.className = cls;
        statusBadge.className = cls;

        // Notes
        var noteContainer = document.getElementById('detailDatBanGhiChuContainer');
        if (d.GhiChu) {
            document.getElementById('detailDatBanGhiChu').textContent = d.GhiChu;
            noteContainer.classList.remove('hidden');
        } else {
            noteContainer.classList.add('hidden');
        }
    }

    function closeDatBanDetailsModal() {
        var modal = document.getElementById('datBanDetailsModal');
        if(modal) modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    function openEditFromDetails() {
        closeDatBanDetailsModal();
        // Allow time for close animation or just small delay for UX
        setTimeout(() => {
            openEditDatBanModal(currentDetailDatBanId);
        }, 100);
    }

    // ==========================================================
    // EDIT MODAL LOGIC (Using GetReservation endpoint)
    // ==========================================================
    function openEditDatBanModal(id) {
        var modal = document.getElementById('editDatBanModal');
        if (!modal) return;

        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';

        // Fetch Data AND Tables using GetReservation endpoint
        fetch('@Url.Action("GetReservation", "DatBan", new { area = "Employee_65133141" })/' + id + '?t=' + new Date().getTime())
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    var d = data.data;
                    document.getElementById('editDatBanID').value = d.DatBanID;
                    document.getElementById('editHoTenKhach').value = d.HoTenKhach;
                    document.getElementById('editSDTKhach').value = d.SDTKhach;
                    document.getElementById('editSoNguoi').value = d.SoNguoi;
                    document.getElementById('editGhiChu').value = d.GhiChu;
                    document.getElementById('editTrangThai').value = d.TrangThai;

                    // Date
                    if (d.ThoiGianDen) {
                         document.getElementById('editThoiGianDen').value = d.ThoiGianDen;
                    }

                    // Populate Tables
                    var select = document.getElementById('editBanID');
                    select.innerHTML = '<option value="">-- Chọn bàn --</option>';
                    if (data.tables && Array.isArray(data.tables)) {
                        data.tables.forEach(t => {
                            var option = document.createElement('option');
                            option.value = t.Value;
                            option.text = t.Text;
                            option.dataset.capacity = t.Capacity;
                            if (t.Value === d.BanID) option.selected = true;
                            select.appendChild(option);
                        });
                        setTimeout(function() { filterTables('editSoNguoi', 'editBanID'); }, 100);
                    }
                } else {
                    showAlert('error', data.message);
                    closeEditDatBanModal();
                }
            })
            .catch(err => {
                console.error(err);
                showAlert('error', 'Có lỗi xảy ra khi tải dữ liệu.');
                closeEditDatBanModal();
            });
    }

    function closeEditDatBanModal() {
        var modal = document.getElementById('editDatBanModal');
        if(modal) modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // Validation Helper
    function validateDatBanInput(name, phone, email, people) {
        const nameRegex = /^[a-zA-ZÀ-ỹ\s]+$/;
        if (!name || !name.trim()) return { valid: false, message: 'Vui lòng nhập họ tên khách hàng.' };
        if (!nameRegex.test(name)) return { valid: false, message: 'Tên khách hàng chỉ được chứa chữ cái và khoảng trắng.' };

        const phoneRegex = /^\d{10}$/;
        if (!phoneRegex.test(phone)) return { valid: false, message: 'Số điện thoại phải gồm đúng 10 chữ số.' };

        if (email && email.trim() !== '') {
            // Strict email regex: Only letters, numbers, and . _ -
            const emailRegex = /^[a-zA-Z0-9._-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(email)) return { valid: false, message: 'Email chỉ được chứa chữ, số và các ký tự:  _ . -' };
        }
        
        if (people && parseInt(people) < 1) return { valid: false, message: 'Số người phải lớn hơn 0.' };

        return { valid: true };
    }

    // Handle Create Form Submit
    var createForm = document.getElementById('createDatBanForm');
    if(createForm) {
        createForm.addEventListener('submit', function(e) {
            var name = document.getElementById('createCustomerName').value;
            var phone = document.getElementById('createCustomerPhone').value;
            var email = document.getElementById('createCustomerEmail').value;
            var people = document.getElementById('createSoNguoi').value;

            var val = validateDatBanInput(name, phone, email, people);
            if (!val.valid) {
                e.preventDefault();
                showAlert('error', val.message);
            }
        });
    }

    // Handle Edit Form Submit
    document.getElementById('editDatBanForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        var name = document.getElementById('editHoTenKhach').value;
        var phone = document.getElementById('editSDTKhach').value;
        var people = document.getElementById('editSoNguoi').value;

        var val = validateDatBanInput(name, phone, null, people);
        if (!val.valid) {
            showAlert('error', val.message);
            return;
        }

        var form = this;
        var formData = new FormData(form);
        var btn = form.querySelector('button[type="submit"]');
        var originalText = btn.textContent;
        
        btn.disabled = true;
        btn.textContent = 'Đang lưu...';

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                closeEditDatBanModal();
                showAlert('success', 'Cập nhật thành công!');
                setTimeout(() => window.location.reload(), 1000);
            } else {
                showAlert('error', data.message);
                btn.disabled = false;
                btn.textContent = originalText;
            }
        })
        .catch(err => {
            console.error(err);
            showAlert('error', 'Có lỗi xảy ra khi lưu dữ liệu.');
            btn.disabled = false;
            btn.textContent = originalText;
        });
    });

    // Close on Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
            closeDatBanDetailsModal();
            closeEditDatBanModal();
        }
    });

    // Handle TempData Alerts on Load
    document.addEventListener('DOMContentLoaded', function() {
        var successMsg = '@Html.Raw(TempData["SuccessMessage"] ?? "")';
        var errorMsg = '@Html.Raw(TempData["ErrorMessage"] ?? "")';

        if (successMsg) showAlert('success', successMsg);
        if (errorMsg) showAlert('error', errorMsg);
        
        setupInputValidation();
    });

    function setupInputValidation() {
        // Name: Letters & Spaces only
        ['createCustomerName', 'editHoTenKhach'].forEach(id => {
            var el = document.getElementById(id);
            if(el) {
                el.addEventListener('input', function() {
                    this.value = this.value.replace(/[^a-zA-ZÀ-ỹ\s]/g, '');
                });
            }
        });

        // Phone: Numbers only, max 10
        ['createCustomerPhone', 'editSDTKhach'].forEach(id => {
             var el = document.getElementById(id);
            if(el) {
                el.setAttribute('maxLength', '10');
                el.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }
        });
    }

    function toggleFilterDropdown() {
        const dd = document.getElementById('filterDropdown');
        if (dd) dd.classList.toggle('hidden');
    }

    function selectStatus(status) {
        const input = document.getElementById('statusFilterInput');
        if (input) {
            input.value = status;
            // Submit form for live reload? Or just trigger search
            // Since form is GET, submitting it refreshes page with params.
            // Ideally we want AJAX refresh like Search.
            // For now, let's just submit the form to keep it simple as before.
            input.form.submit();
        }
        toggleFilterDropdown();
    }

    // Close filter dropdown on click outside
    document.addEventListener('click', function(e) {
        const dd = document.getElementById('filterDropdown');
        const btn = document.getElementById('filterBtn');
        if (dd && !dd.classList.contains('hidden') && !dd.contains(e.target) && !btn.contains(e.target)) {
            dd.classList.add('hidden');
        }
    });

    // --- Live Search & Autocomplete ---
    const searchInput = document.getElementById('searchInput');
    const suggestionsBox = document.getElementById('searchSuggestions');
    const searchLoading = document.getElementById('searchLoading');
    const datBanListContainer = document.getElementById('datban-list-container');
    let searchDebounceTimer;
    let suggestionsDebounceTimer;

    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const term = e.target.value.trim();

            clearTimeout(searchDebounceTimer);
            clearTimeout(suggestionsDebounceTimer);

            // 1. Live Search
            if (searchLoading) searchLoading.classList.remove('hidden');
            searchDebounceTimer = setTimeout(() => {
                performLiveSearch(term);
            }, 300);

            // 2. Suggestions
            if (term.length >= 1) {
                suggestionsDebounceTimer = setTimeout(() => {
                    fetchSuggestions(term);
                }, 200);
            } else {
                if (suggestionsBox) suggestionsBox.classList.add('hidden');
            }
        });

        // Focus shows suggestions
        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 1 && suggestionsBox && suggestionsBox.children.length > 0) {
                suggestionsBox.classList.remove('hidden');
            }
        });

        // Click outside closes suggestions
        document.addEventListener('click', function(e) {
            if (suggestionsBox && !suggestionsBox.contains(e.target) && e.target !== searchInput) {
                suggestionsBox.classList.add('hidden');
            }
        });
    }

    function performLiveSearch(term) {
        const form = document.querySelector('form[action*="Index"]'); 
        if (!form) return;

        const formData = new FormData(form);
        formData.set('searchString', term);
        
        const params = new URLSearchParams(formData);

        fetch('@Url.Action("Index", "DatBan", new { area = "Employee_65133141" })?' + params.toString(), {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.text())
        .then(html => {
            if (datBanListContainer) {
                datBanListContainer.innerHTML = html;
            }
        })
        .finally(() => {
             if (searchLoading) searchLoading.classList.add('hidden');
        });
    }

    function fetchSuggestions(term) {
        fetch('@Url.Action("GetSearchSuggestions", "DatBan", new { area = "Employee_65133141" })?term=' + encodeURIComponent(term))
            .then(res => res.json())
            .then(data => {
                if (!suggestionsBox) return;
                
                if (data.length === 0) {
                    suggestionsBox.classList.add('hidden');
                    return;
                }

                let html = '';
                data.forEach(item => {
                    html += `
                        <div class="px-4 py-2 hover:bg-stone-100 cursor-pointer flex items-center gap-3 transition-colors text-left border-b border-stone-50 last:border-0" onclick="selectSuggestion('${item.value}')">
                            <div class="w-8 h-8 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center font-bold text-xs shrink-0 border border-amber-200">
                                ${item.avatar}
                            </div>
                            <div>
                                <div class="text-sm font-semibold text-stone-800">${item.label}</div>
                                <div class="text-xs text-stone-500">${item.desc}</div>
                            </div>
                        </div>
                    `;
                });
                
                suggestionsBox.innerHTML = html;
                suggestionsBox.classList.remove('hidden');
            })
            .catch(err => console.error(err));
    }

    function selectSuggestion(value) {
        if (searchInput) {
            searchInput.value = value;
            suggestionsBox.classList.add('hidden');
            performLiveSearch(value);
        }
    }
</script>

<style>
    /* Pagination Styles - Luxury Amber Theme */
    .pagination-container {
        margin-top: 3rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }
    .pagination-buttons {
        display: flex;
        gap: 0.75rem;
        align-items: center;
    }
    .pagination-btn {
        width: 40px; height: 40px;
        display: flex; align-items: center; justify-content: center;
        border: 1px solid #d6d3d1; background: white; border-radius: 50%;
        cursor: pointer; transition: all 0.3s ease;
        font-weight: 500; color: #78716c; text-decoration: none; font-size: 18px;
    }
    .pagination-btn:hover:not(.active):not(.disabled) {
        border-color: #d97706; color: #d97706; transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(217, 119, 6, 0.15);
    }
    .pagination-btn.active {
        width: 44px; height: 44px;
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); 
        border: none; border-radius: 50%;
        color: white; font-size: 16px; font-weight: 600;
        box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
    }
    .pagination-btn.disabled {
        opacity: 1; color: #a8a29e; border-color: #e7e5e4;
        cursor: not-allowed; background: #fafaf9;
    }
    .pagination-info {
        color: #b45309; font-size: 14px; font-weight: 500;
    }
    
    /* Auth Modal Styles - Luxury Amber Theme */
    .auth-modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(28, 25, 23, 0.6); display: flex; align-items: center; justify-content: center;
        z-index: 9999; backdrop-filter: blur(6px);
    }
    .auth-modal-container {
        background: white; border-radius: 20px; box-shadow: 0 25px 80px rgba(0, 0, 0, 0.35);
        width: 90%; max-height: 90vh; display: flex; flex-direction: column; overflow: hidden; animation: authSlideIn 0.3s ease-out;
        border: 1px solid rgba(212, 175, 55, 0.1);
    }
    .auth-modal-header { padding: 28px 32px; text-align: center; border-bottom: 1px solid #f5f5f4; background: linear-gradient(180deg, #fffbeb 0%, #ffffff 100%); }
    .auth-logo { width: 52px; height: 52px; margin: 0 auto 16px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #b45309; border-radius: 14px; border: 1px solid rgba(212, 175, 55, 0.2); }
    .auth-modal-title { font-size: 24px; font-weight: 700; color: #1c1917; margin-bottom: 8px; font-family: 'Inter', sans-serif !important; }
    .auth-modal-subtitle { color: #78716c; font-size: 14px; }
    .auth-modal-body { 
        padding: 32px; 
        overflow-y: auto; 
        /* Hide scrollbar */
        scrollbar-width: none; 
        -ms-overflow-style: none;
    }
    .auth-modal-body::-webkit-scrollbar { 
        display: none; 
    }
    .auth-form-group { margin-bottom: 20px; }
    .auth-form-label { display: block; font-size: 14px; font-weight: 600; color: #44403c; margin-bottom: 8px; }
    .auth-required { color: #dc2626; margin-left: 2px; }
    .auth-input-wrapper { position: relative; }
    .auth-form-control { width: 100%; padding: 12px 16px; border: 1.5px solid #e7e5e4; border-radius: 12px; font-size: 14px; transition: all 0.2s; background: #fafaf9; }
    .auth-form-control:focus { outline: none; border-color: #d97706; box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.1); background: white; }
    .auth-btn-group { display: flex; gap: 12px; justify-content: flex-end; }
    .auth-btn { padding: 12px 24px; border-radius: 12px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.2s; }
    .auth-btn-cancel { background: white; border: 1.5px solid #e7e5e4; color: #44403c; }
    .auth-btn-cancel:hover { background: #fafaf9; border-color: #d6d3d1; }
    .auth-btn-submit { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border: none; color: white; box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3); }
    .auth-btn-submit:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(217, 119, 6, 0.4); }
    @@keyframes authSlideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>
